---
title: ğŸ’»[C#]IPC í†µì‹ íƒêµ¬ (Shared Memory)-2
date: 2024-05-24 +09:00
categories: [Tech, C#]
tags:
  [
  C#, IPC, SharedMemory
  ]
image : /assets/img/Cat/IPC_Cat.png
published: true
hidden : false
---

## ğŸ“š ê°œë°œ í™˜ê²½

* <img src="https://cdn3.emoji.gg/emojis/8574_visual_studio.png" alt="View" width="25" height="25"> VisualStudio 2022
* <img src="https://cdn3.emoji.gg/emojis/3846-dotnet.png" alt="View" width="25" height="25"> `.NET 6`
*  <img src="https://cdn3.emoji.gg/emojis/1739_CMD.png" alt="View" width="30" height="30">  `Console APP` 


---
## ğŸ“‘ MemoryMappedFile 

ì‹¤ìŠµì— ë“¤ì–´ê°€ê¸°ì— ì•ì„œ  [MSDN](https://learn.microsoft.com/ko-kr/dotnet/api/system.io.memorymappedfiles?view=net-6.0) ì„ ì°¸ì¡°í•œ ê²°ê³¼ `Shared Memory`ë¥¼ êµ¬í˜„í•˜ê¸°ìœ„í•´ `MemoryMappedFile`ì„ ì´ìš©í•œë‹¤ë”ë¼...
ë©”ëª¨ë¦¬ ë§¤í•‘ëœ íŒŒì¼ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤ì´ë©° íŒŒì¼ ë‚´ìš©ì„ ì• í”Œë¦¬ì¼€ì´ì…˜ **ë…¼ë¦¬ì  ì£¼ì†Œ** ê³µê°„ì— ë§¤í•‘í•œë‹¤.
ì˜¤ëŠ˜ì€ ì´ ë…€ì„ì„ íŒŒí•´ì³ ë³´ì!
<br>


| Method                                                                                            | Description                                                                                    |
| ------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------- |
| `CreateNew(String, Int64)`                                                                        | ì‹œìŠ¤í…œ ë©”ëª¨ë¦¬ì—ì„œ ì§€ì •ëœ ìš©ëŸ‰ì„ ê°€ì§„ ë©”ëª¨ë¦¬ ë§¤í•‘ëœ íŒŒì¼ì„ ë§Œë“­ë‹ˆë‹¤.                            |
| `CreateNew(String, Int64, MemoryMappedFileAccess)`                                                | ì‹œìŠ¤í…œ ë©”ëª¨ë¦¬ì—ì„œ ì§€ì •ëœ ìš©ëŸ‰ê³¼ ì•¡ì„¸ìŠ¤ í˜•ì‹ì„ ê°€ì§„ ë©”ëª¨ë¦¬ ë§¤í•‘ëœ íŒŒì¼ì„ ë§Œë“­ë‹ˆë‹¤.              |
| `CreateNew(String, Int64, MemoryMappedFileAccess, MemoryMappedFileOptions, HandleInheritability)` | ì§€ì •ëœ ì´ë¦„, ìš©ëŸ‰, ì•¡ì„¸ìŠ¤ í˜•ì‹, ë©”ëª¨ë¦¬ í• ë‹¹ ì˜µì…˜ ë° ìƒì†ì„ ê°€ì§„ ë©”ëª¨ë¦¬ ë§¤í•‘ëœ íŒŒì¼ì„ ë§Œë“­ë‹ˆë‹¤. |

ê·¸ë¦¬ê³  ë°ì´í„°ë¥¼ ì½ê¸° ìœ„í•´ `MemoryMappedViewAccessor` ì„ ì‚¬ìš©í•œë‹¤.

| Method                                                     | Description                                                                                                           |
| ---------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------- |
| `CreateViewAccessor()`                                     | ë©”ëª¨ë¦¬ ë§¤í•‘ëœ íŒŒì¼ì˜ ë·°ì— ë§¤í•‘ë˜ëŠ” `MemoryMappedViewAccessor`ë¥¼ ë§Œë“­ë‹ˆë‹¤.                                             |
| `CreateViewAccessor(Int64, Int64)`                         | ì§€ì •ëœ ì˜¤í”„ì…‹ê³¼ í¬ê¸°ë¥¼ ê°€ì§€ê³  ë©”ëª¨ë¦¬ ë§¤í•‘ëœ íŒŒì¼ì˜ ë·°ì— ë§¤í•‘ë˜ëŠ” `MemoryMappedViewAccessor`ë¥¼ ë§Œë“­ë‹ˆë‹¤.               |
| `CreateViewAccessor(Int64, Int64, MemoryMappedFileAccess)` | ì§€ì •ëœ ì˜¤í”„ì…‹, í¬ê¸° ë° ì•¡ì„¸ìŠ¤ ì œí•œì„ ê°€ì§€ê³  ë©”ëª¨ë¦¬ ë§¤í•‘ëœ íŒŒì¼ì˜ ë·°ì— ë§¤í•‘ë˜ëŠ” `MemoryMappedViewAccessor`ë¥¼ ë§Œë“­ë‹ˆë‹¤. |

---

## ğŸ–¥ï¸ Shared Memory êµ¬í˜„
  
### ProcessA

```csharp

//Process A
// "Cat"ì´ë¼ëŠ” ì´ë¦„ì˜ ìƒˆë¡œìš´ ë©”ëª¨ë¦¬ ë§¤í•‘ëœ íŒŒì¼ì„ ìƒì„±í•˜ê³ , ìš©ëŸ‰ì€ 10000ë°”ì´íŠ¸ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
 using (var mmf = MemoryMappedFile.CreateNew("Cat", 10000))
        {
            // ë©”ëª¨ë¦¬ ë§µ íŒŒì¼ì˜ ì „ì²´ë¥¼ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë·° ìƒì„±
            using (var accessor = mmf.CreateViewAccessor())
            {
                // ë¬¸ìì—´ ë°ì´í„°ë¥¼ UTF8ë¡œ ì¸ì½”ë”©í•˜ì—¬ ë°”ì´íŠ¸ ë°°ì—´ë¡œ ë³€í™˜
                string message = "HI Night Mo.";
                byte[] bytes = Encoding.UTF8.GetBytes(message);

                // ë·°ë¥¼ í†µí•´ ë°”ì´íŠ¸ ë°°ì—´ ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ ë§µ íŒŒì¼ì— ì“°ê¸°
                accessor.WriteArray(0, bytes, 0, bytes.Length);
                Console.WriteLine("Message written to shared memory!");
                
            }
        }

  ```
### ProcessB

  <br>

```csharp
//Process B 
  // ê¸°ì¡´ì— ìƒì„±ëœ ë©”ëª¨ë¦¬ ë§µ íŒŒì¼ ì—´ê¸°
using (var mmf = MemoryMappedFile.OpenExisting("Cat"))
            {
                // ë©”ëª¨ë¦¬ ë§µ íŒŒì¼ì˜ ì „ì²´ë¥¼ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë·° ìƒì„±
                using (var accessor = mmf.CreateViewAccessor())
                {
                    // ë°ì´í„°ë¥¼ ì½ì„ ë°”ì´íŠ¸ ë°°ì—´ ìƒì„±
                    byte[] bytes = new byte[10000];

                    // ë·°ë¥¼ í†µí•´ ë©”ëª¨ë¦¬ ë§µ íŒŒì¼ì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ ë°”ì´íŠ¸ ë°°ì—´ì— ì €ì¥
                    accessor.ReadArray(0, bytes, 0, bytes.Length);

                    // ë°”ì´íŠ¸ ë°°ì—´ì„ UTF8 ë¬¸ìì—´ë¡œ ë³€í™˜
                    string message = Encoding.UTF8.GetString(bytes).TrimEnd('\0');
                    Console.WriteLine("Message read from shared memory: " + message);
                }
            }
  ```

---

### ê²°ê³¼

![IPC_S_Dev1](https://github.com/Gubeommo/TIL/assets/86589565/329a87d6-5899-47c3-9791-a94bf40420b5)

<br>

ê°„ë‹¨í•œ ì˜ˆì œë¥¼ í†µí•´ì„œ `Shared Memory`ë¥¼ êµ¬í˜„í•´ ë³´ì•˜ë‹¤. 